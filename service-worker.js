/* Manifest version: CyEZUZN1 */
const e=self;e.importScripts("./script/sw.js"),e.importScripts("./service-worker-assets.js");const s="offline-cache-",t=`${s}${e.assetsManifest.version}`,a=[/\.dll$/,/\.pdb$/,/\.wasm/,/\.html/,/\.js$/,/\.json$/,/\.css$/,/\.woff$/,/\.png$/,/\.jpe?g$/,/\.gif$/,/\.ico$/,/\.blat$/,/\.dat$/],i=[/^service-worker\.js$/,/^service-worker\.published\.js$/],n=new URL("/CyberShelfHost/",e.origin),r=e.assetsManifest.assets.map(e=>new URL(e.url,n).href);e.addEventListener("install",s=>{console.info("[SW] Installing published version..."),s.waitUntil((async()=>{const s=e.assetsManifest.assets.filter(e=>a.some(s=>s.test(e.url))).filter(e=>!i.some(s=>s.test(e.url))).map(e=>new Request(e.url,{cache:"no-cache"})),n=await caches.open(t);await n.addAll(s),await e.skipWaiting()})())}),e.addEventListener("activate",a=>{console.info("[SW] Activated published version. Claiming clients..."),a.waitUntil((async()=>{const a=await caches.keys();await Promise.all(a.filter(e=>e.startsWith(s)&&e!==t).map(e=>caches.delete(e))),await e.clients.claim()})())}),e.addEventListener("fetch",e=>{e.respondWith((async()=>{let s=null;if("GET"===e.request.method){const a="navigate"!==e.request.mode||r.some(s=>s===e.request.url)?e.request:"index.html",i=await caches.open(t);s=await i.match(a)}return s||fetch(e.request)})())});